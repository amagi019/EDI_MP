# 運用テスト仕様書 (Operational Test Plan)

## 1. 目的
本ドキュメントは、「EDI・注文管理システム」における発注・請求機能の改修（請求書・支払通知書の分離、レイアウト変更、採番ルール変更等）が正しく動作することを確認するための手順書です。

## 2. テスト環境
- **接続先**: 
    - ローカル環境: `http://127.0.0.1:8000/`
    - (アクセス可能な場合) テスト環境: `https://edi-system-test-55008100947.asia-northeast1.run.app`
- **対象ブラウザ**: Google Chrome (最新版)
- **前提条件**:
    - 管理者ユーザーおよび取引先ユーザーが作成済みであること。
    - テスト用のプロジェクト、取引先データが存在すること。

## 3. テストシナリオ

### シナリオA: 注文書の作成と発行 (管理者)
| ID | 確認項目 | 手順 | 期待値 |
|:--|:---|:---|:---|
| A-1 | 注文書の作成 | 1. 管理画面またはダッシュボードより新規注文を作成する。<br>2. 必須項目（取引先、プロジェクト、期間、金額等）を入力し保存する。 | 注文ステータスが「下書き」で保存されること。<br>注文番号が `MP+YYYYMMDD+連番` の形式で採番されること。 |
| A-2 | 注文書PDF確認 | 1. 作成した注文書の詳細画面を開く。<br>2. 「注文書PDF」ボタンを押下する。 | PDFが別タブで開き、レイアウト崩れがないこと。<br>「甲・乙」の情報が正しく表示されていること。 |
| A-3 | 正式発行 | 1. 注文書詳細画面で「正式発行」ボタンを押下する。 | ステータスが「未確認（発行済）」または「受領確認中」に遷移すること。<br>取引先に通知メールが送信されること（ログ確認）。 |

### シナリオB: 注文の受領と承諾 (取引先)
| ID | 確認項目 | 手順 | 期待値 |
|:--|:---|:---|:---|
| B-1 | 注文内容の確認 | 1. 取引先アカウントでログインする。<br>2. ダッシュボードの通知または注文一覧から該当の注文を選択する。 | 正式発行された注文内容が閲覧できること。<br>「注文書PDF」がダウンロード可能であること。 |
| B-2 | 承諾操作 | 1. 注文詳細画面で「承諾する」ボタンを押下する。 | ステータスが「承認済」または「受領済」になること。<br>システム側で「注文請書」が自動生成・保存されること。 |
| B-3 | 注文請書確認 | 1. 画面上の「注文請書PDF」ボタンを押下する。 | PDFがダウンロードされ、署名欄に取引先名が印字されていること。<br>収入印紙枠が表示されていること。 |

### シナリオC: 請求書・支払通知書の発行 (管理者)
| ID | 確認項目 | 手順 | 期待値 |
|:--|:---|:---|:---|
| C-1 | 請求書データの作成 | 1. 管理画面より、承認済みの注文に対して請求書データを作成する。<br>2. `target_month` (対象年月) を指定して保存する。 | 請求書番号が `YYMM+連番` (例: 2602001) の形式で採番されること。<br>検収番号が `MP+請求番号` となること。 |
| C-2 | 請求書PDF確認 | 1. 「請求書PDF」ボタンを押下する。 | **11列レイアウト**のPDFが生成されること。<br>部署名、インボイス登録番号、振込先口座が正しく表示されていること。 |
| C-3 | 支払通知書PDF確認 | 1. 「支払通知書PDF」ボタンを押下する。 | **8列レイアウト**のPDFが生成されること。<br>タイトルが「◯年◯月度 検収兼お支払通知書」となっていること。 |

## 4. トラブルシューティング
- **PDFが開かない**: ブラウザのポップアップブロックを確認してください。
- **文字化け**: 日本語フォント (HeiseiMin-W3) が適用されているか確認してください。
- **権限エラー (403)**: 正しいユーザー（管理者 または 該当する取引先）でログインしているか確認してください。
