# 業務フロー：基本契約締結から支払通知書発行・承認まで（改善版）

プロジェクト内における、業務委託契約の締結から発注、支払通知に至る標準的な業務プロセス（改善版）を以下に整理します。

---

## 1. 基本契約書の作成

### 自社担当者の作業
- パートナーの担当者へ調査表明の入力依頼メールを送付する。
- 弊社EDIのご利用案内「EDIーMPのご利用に関するご案内」をシステム上で共有する。

### パートナー担当者の作業
1. **オンライン基本情報登録**: メールに記載された専用URLにアクセスし、以下の情報をEDI上のWebフォームで直接入力する。
   - 会社詳細（会社名、代表者情報、住所、連絡先など）
   - **インボイス制度対応**: 適格請求書発行事業者番号（T番号）を入力。システムが国税庁の情報を参照し、有効性を確認する。
   - **振込先情報**: 銀行選択マスターから金融機関・支店を選択。銀行コード等が自動補完され、正確な情報を登録する。
   - **添付書類のアップロード**: 決算報告書等の必要書類を直接アップロードする。
2. **送信**: 入力内容を確認し、送信ボタンをクリックする。

### システムの動作
- 受信した情報をDBに登録し、自社担当者へ登録完了の通知を行う。

---

## 2. Googleドキュメントによる電子署名依頼

### 送信者（自社担当者）の作業
1. **作成**: Googleドキュメントで電子契約書を作成する。
2. **電子署名設定**: メニューの「ツール」→「電子署名」にて、EDIに登録されたパートナー情報を元に署名者を指定する。
3. **リクエスト**: フィールド配置後、「署名をリクエスト」をクリックして送信する。

### 受信者（パートナー担当者）の作業
1. **署名実施**: 依頼メールからGoogleドキュメントを開き、電子署名を実施して「完了としてマーク」する。

### システムの動作（API連携）
- **ステータス自動同期**: Google Docs側の署名完了イベントをシステムが検知し、EDI上の契約ステータスを「締結済」に自動更新する。
- **通知の自動化**: パートナーおよび自社担当者へ、契約締結完了の確認通知を自動送信する。

---

## 3. 基本契約書の締結完了

### 自社担当者の作業
- システム上の契約ステータスが「締結済」であることを確認する（手動のメール送信は不要）。

### パートナー担当者の作業
- EDIのマイページから、いつでも締結済みの契約書を確認・ダウンロードできる。

---

## 4. 発注書の作成から承認

### 自社担当者の作業
- EDIに発注データを登録する。
- **入力項目**: 取引先、件名、業務内容、作業者、数量、単価、金額、消費税（T番号に基づく）、支払・精算条件、プロジェクト期間、サイクルなど。

### システムの動作
1. **下書き（DRAFT）生成**: 管理者が発注データを登録すると、当初は「下書き」ステータスで保存されます。この段階ではパートナーには公開されません。
2. **正式発行（UNCONFIRMED）**: 管理者が内容を確認し「正式発行」ボタンをクリックすると、ステータスが「未確認（発行済）」となり、パートナーへ通知および公開が行われます。この際、配信用の注文書PDFが原本として永続保存されます。

### パートナー担当者の作業
1. **内容確認**: 通知内のリンクからログインし、注文書等のプレビューを確認する。
2. **承認**: 内容に問題がなければ「承認」ボタンをクリックする。

### システムの動作
- **ステータス更新**: 承認ステータスを「承認済（APPROVED）」に更新します。
- **証跡管理（タイムスタンプ）**: 承認時の日時を `finalized_at` として記録します。
- **注文請書の自動生成**: 承認と同時に、システムが「注文請書」PDFを自動生成。SHA256ハッシュ値を算出してDBに記録し、PDF本体を永続ストレージに保存します。
- **電帳法・インボイス対応**: 保存されたPDFは「原本」として管理され、以降の表示・ダウンロードではこの保存ファイルが配信されます。

### 自社担当者の作業
- 管理画面から、全パートナーの承認進捗および書類の保存状況をリアルタイムで確認する。
