# EDIシステム 業務フロー改善提案

提供された業務フローに基づき、EDIシステムとしての効率性、正確性、およびコンプライアンス（法対応）の観点から改善案を提示します。

## 1. 入力作業の効率化とデータ一元化

### 現状の課題
- パートナー側で「Excelへの記入」と「Webフォームへの入力」の両方が発生しており、二重手間となっている。
- Excelデータを人間が確認してシステムに再入力（またはアップロード）する際の手間とミスが発生する可能性がある。

### 改善案
- **Webフォームへの完全移行**: 手書きやExcelを廃止し、すべての情報をWebフォーム（EDI上の登録画面）で直接入力させる。
- **Excelアップロード・自動パース**: どうしてもExcelが必要な場合は、パートナーがアップロードしたファイルをシステムが自動解析し、Webフォームの入力を補完する。

## 2. 電子署名とEDIシステムの連携

### 現状の課題
- Googleドキュメントでの署名プロセスがEDIシステムの外で行われており、締結完了後に自社担当者が手動でEDIのステータスを更新（またはメール送信）する必要がある。

### 改善案
- **OAuth/API連携**: Google Docs API または電子署名専用ツール（DocuSign等）のAPIを利用し、署名が完了した時点でEDI側のステータスを自動的に「締結済」へ変更する。
- **通知の自動化**: 署名完了トリガーで、パートナーへの「完了確認メール」をシステムから自動送信する。

## 3. インボイス制度・電子帳簿保存法への対応

### 現状の課題
- パートナーが適格請求書発行事業者であるかどうかの確認フローが明記されていない。
- 支払通知書や請求書が電子帳簿保存法の要件を満たした状態で適切に保存・管理される必要がある。

### 改善案
- **登録番号の収集**: 初期の情報登録（Step 1）において、適格請求書発行事業者の「登録番号（T番号）」の入力を必須化し、国税庁のAPI等で有効性をチェックする。
- **タイムスタンプ・検索要件の確保**: EDIシステム内で発行・受領した書類に対し、訂正削除履歴の保持や、日付・金額・取引先での検索機能を備え、電子帳簿保存法に対応する。

## 4. 振込情報の正確性向上

### 現状の課題
- 銀行名や銀行コードを手入力する場合、スペルミスや存在しないコードの入力が発生しやすい。

### 改善案
- **銀行マスターの導入**: 銀行名・支店名を選択式（サジェスト機能付き）にし、正しい銀行コード・支店コードが自動セットされるようにする。これにより、銀行振込データ（FBデータ）作成時のエラーを未然に防ぐ。

## 5. 発注フローの透明性とリードタイム短縮

### 現状の課題
- 「定期的に注文書を作成・送信」する際、パートナーが内容を把握するタイミングがメール受信時となり、事前の調整不足による修正が発生しやすい。

### 改善案
- **プレビュー機能と下書き共有**: 注文書が正式に発行される前に、EDI上で「下書き（ドラフト）」をパートナーが確認できるフェーズを設ける。
- **注文請書の自動生成**: パートナーが「承認」ボタンを押した際、システム側で自動的に「注文請書」のPDFを生成し、自社側の受領エビデンスとして保存する。

---

## 6. 実装状況のまとめ（2026年2月改修版）

上記の改善提案は、現在のシステムにおいてすべて実装されています。

| 改善項目 | 実装ステータス | 主要な実装内容 |
| :--- | :--- | :--- |
| **1. 入力作業の効率化** | 完了 | `PartnerOnboardingForm` によるオンライン登録。 |
| **2. 電子署名連携** | 完了 | `SignatureService` と Webhook エンドポイントの実装。 |
| **3. インボイス・電帳法** | 完了 | T番号バリデーション、PDF永続保存、ハッシュ値生成。 |
| **4. 振込情報の正確性** | 完了 | `BankMaster` モデルによる銀行・支店選択機能。 |
| **5. 発注フローの透明性** | 完了 | `DRAFT` ステータスと管理者による正式発行機能。 |
