# 発注管理 設計書

## 1. 機能概要
自社からの発注データを基に注文書を生成し、取引先が内容を確認・受領するまでのプロセス。

- **注文データ登録**: 自社システムからのインポートまたは管理画面からの登録。
- **注文書自動発行**: 登録データからPDFを生成。
- **注文請書 回収**: 取引先がPDFをDLまたは確認ボタン押下で「受領済」に更新。

## 2. 画面設計
- **注文データ登録画面**: 取引先、プロジェクト、期間、金額等の入力フォーム。
- **注文書一覧画面（取引先用）**: 未受領、受領済別に注文書を表示。
- **注文書詳細画面**: 注文内容の表示、PDFプレビュー、DLボタン。

## 3. 入出力仕様
### 入力項目（注文登録）
- 取引先ID (customer_id)
- プロジェクトID (project_id)
- 作業期間 (work_start/end)
- 料金（基本料金、超過・不足単価など） (base_fee, etc.)

### 出力項目
- 注文書PDF（社印等を含む指定フォーマット）
- 注文ステータス（未確認 / 確認中 / 受領済）

## 4. 業務ロジック
- **PDF生成**: `reportlab` や `WeasyPrint` 等を使用し、モデルデータからPDFを動的に生成。
- **受領フラグ更新**: 初回のDLアクション時に `status` を 'RECEIVED' 等に自動更新する。

## 5. エラーハンドリング
- 必須項目未入力エラー。
- 過去日付での発注登録制限（必要に応じて）。

## 6. セキュリティ要件
- 自社の担当する取引先以外の注文書へのアクセス禁止。