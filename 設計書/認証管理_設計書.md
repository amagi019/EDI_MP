# 認証管理 設計書

## 1. 機能概要
取引先および自社管理者がシステムを利用するための認証およびアカウント管理機能。

- **取引先ログイン**: 発行されたID/PWによる認証。初回ログイン時のパスワード変更を強制する。
- **2段階認証（2FA）**: セキュリティ強化のため、ログイン時にワンタイムパスワード（OTP）による検証を必須とする。
- **アカウント管理**: 取引先担当者の追加・編集・削除。
- **権限管理**: 担当者ごとの操作権限制御。

## 2. 画面設計
- **ログイン画面**: ID、パスワード入力フィールド、ログインボタン。
- **パスワード変更画面**: 初回ログイン時またはユーザーによる任意変更時に使用。旧パスワード、新パスワード（確認用含む）入力。
- **アカウント一覧・管理画面**: 担当者の一覧表示と追加・編集フォーム。

## 3. 入出力仕様
### 入力項目（アカウント登録）
- 氏名
- メールアドレス（ログインIDとして利用）
- 権限（「管理者：全操作可」「一般：閲覧・DLのみ」等）

### 出力項目
- ログイン成否メッセージ
- アカウント一覧（名前、メール、権限、最終ログイン日時）

## 4. 業務ロジック
- **初回ログイン判定**: Userモデル等の `is_first_login` フラグにより、Trueの場合はパスワード変更画面へ強制リダイレクトする。
- **パスワードハッシュ化**: Django標準の `set_password` 等を利用し、平文での保存を禁止する。

## 5. エラーハンドリング
- ID/PW不一致時の汎用エラー表示。
- アカウントロック（5回連続失敗時等）。

## 6. セキュリティ要件
- パスワードポリシー: 8文字以上、英数字混合必須。
- セッション有効期限の設定。